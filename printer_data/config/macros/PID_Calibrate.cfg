#[gcode_macro PIDCalibrate]
#gcode:
#  #BEEP
#  CENTRADO
#  #BEEP
#  PID_CALIBRATE HEATER=extruder TARGET=210
#  PID_CALIBRATE HEATER=heater_bed TARGET=70
#  #BEEP
#  SAVE_CONFIG
#  CENTRADO


  [gcode_macro CALIBRAR_TODO_PID]
description: Calibra PID de cama y hotend secuencialmente. Uso: CALIBRAR_TODO_PID T_EXTRUDER=210 T_BED=60
gcode:
    # 1. Parámetros de temperatura configurables
    {% set T_EXTRUDER = params.T_EXTRUDER|default(210)|float %}
    {% set T_BED = params.T_BED|default(60)|float %}

    # 2. Preparación inicial
    M117 Homeneando ejes...
    G28                            ; Home obligatorio para seguridad
    G1 Z50 F3000                   ; Eleva el cabezal para alejarlo de la cama
    M117 Calibrando Cama...
    
    # 3. Calibración de la Cama (Heater Bed)
    # Se hace primero la cama ya que tarda más en estabilizarse
    PID_CALIBRATE HEATER=heater_bed TARGET={T_BED}
    
    # 4. Preparación para Hotend
    M117 Calibrando Hotend...
    M106 S255                      ; Activa ventilador de capa al 100% (Práctica recomendada 2026)
    
    # 5. Calibración del Hotend (Extruder)
    PID_CALIBRATE HEATER=extruder TARGET={T_EXTRUDER}
    
    # 6. Finalización
    M106 S0                        ; Apaga ventilador
    G28                            ; Home final
    M117 Proceso finalizado.
    {action_respond_info("Calibración completa. USA EL COMANDO 'SAVE_CONFIG' AHORA.")}
